From 4e575ccdc3ebed46a129a3ba5af127e4aa009f72 Mon Sep 17 00:00:00 2001
From: Mehdi Sabwat <mehdi@videolabs.io>
Date: Fri, 9 Apr 2021 13:40:32 +0200
Subject: [PATCH 2/6] contrib: disable big endian test for openjpeg

---
 contrib/src/openjpeg/emscripten.patch | 28 +++++++++++++++++++++++++++
 contrib/src/openjpeg/rules.mak        |  1 +
 2 files changed, 29 insertions(+)
 create mode 100644 contrib/src/openjpeg/emscripten.patch

diff --git a/contrib/src/openjpeg/emscripten.patch b/contrib/src/openjpeg/emscripten.patch
new file mode 100644
index 0000000000..c694ab26e5
--- /dev/null
+++ b/contrib/src/openjpeg/emscripten.patch
@@ -0,0 +1,28 @@
+From 7bbaf6c3ed5062cb06b480c7a7b5fce02950776c Mon Sep 17 00:00:00 2001
+From: Mehdi Sabwat <mehdi@videolabs.io>
+Date: Fri, 9 Apr 2021 13:32:10 +0200
+Subject: [PATCH 1/1] emscripten
+
+---
+ CMakeLists.txt | 3 +++
+ 1 file changed, 3 insertions(+)
+
+diff --git a/CMakeLists.txt b/CMakeLists.txt
+index ff70a06..2b1478a 100644
+--- a/CMakeLists.txt
++++ b/CMakeLists.txt
+@@ -160,8 +160,11 @@ endif()
+ 
+ #-----------------------------------------------------------------------------
+ # Big endian test:
++if (NOT ${CMAKE_SYSTEM_NAME} MATCHES "Emscripten")
+ include (${CMAKE_ROOT}/Modules/TestBigEndian.cmake)
+ TEST_BIG_ENDIAN(OPJ_BIG_ENDIAN)
++endif()
++
+ 
+ #-----------------------------------------------------------------------------
+ # Setup file for setting custom ctest vars
+-- 
+2.28.0
+
diff --git a/contrib/src/openjpeg/rules.mak b/contrib/src/openjpeg/rules.mak
index 184c484f00..ae16ef24dc 100644
--- a/contrib/src/openjpeg/rules.mak
+++ b/contrib/src/openjpeg/rules.mak
@@ -19,6 +19,7 @@ ifdef HAVE_VISUALSTUDIO
 #	$(APPLY) $(SRC)/openjpeg/msvc.patch
 endif
 #	$(APPLY) $(SRC)/openjpeg/restrict.patch
+	$(APPLY) $(SRC)/openjpeg/emscripten.patch
 	$(APPLY) $(SRC)/openjpeg/install.patch
 	$(APPLY) $(SRC)/openjpeg/pic.patch
 	$(APPLY) $(SRC)/openjpeg/openjp2_pthread.patch
-- 
2.28.0

