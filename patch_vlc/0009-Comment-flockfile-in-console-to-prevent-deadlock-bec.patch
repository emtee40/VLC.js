From 8242e0f8c52a5f3c900d6b98f7f7d85cf03a881f Mon Sep 17 00:00:00 2001
From: Etienne Brateau <etienne.brateau@gmail.com>
Date: Wed, 16 Aug 2017 13:51:18 +0200
Subject: [PATCH 9/9] Comment flockfile in console to prevent deadlock because
 of a bug in emscripten / musl.

---
 modules/logger/console.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/modules/logger/console.c b/modules/logger/console.c
index 14627479c9..3da4d2afa5 100644
--- a/modules/logger/console.c
+++ b/modules/logger/console.c
@@ -52,7 +52,8 @@ static void LogConsoleColor(void *opaque, int type, const vlc_log_t *meta,
     if (verbose < type)
         return;
 
-    flockfile(stream);
+// flockfile cause a deadlock with emscripten, wait for a fix
+//    flockfile(stream);
     fprintf(stream, "["GREEN"%0*"PRIxPTR GRAY"] ", ptr_width,
             meta->i_object_id);
     if (meta->psz_header != NULL)
@@ -61,7 +62,7 @@ static void LogConsoleColor(void *opaque, int type, const vlc_log_t *meta,
             msg_type[type], msg_color[type]);
     vfprintf(stream, format, ap);
     fputs(GRAY"\n", stream);
-    funlockfile(stream);
+//    funlockfile(stream);
 }
 #endif /* !_WIN32 */
 
-- 
2.14.1

