<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>VLC.js</title>
    <style>
        .emscripten {
            text-align: center;
        }
        body {
            background-color: #343a40;
        }
        #canvas {
            border:0 !important;
            display: flex;
            margin: 0 auto;
            background-color: #000;
        }
        #overlay {
            border:0 !important;
            display: flex;
            margin: 0 auto;
        }
        #stack {
            display: grid;
        }
        #stack > canvas {
            grid-column: 1;
            grid-row: 1;
        }
        #spinner {
            display: none;
        }
        #status {
            display: none;
        }
        #progress {
            margin-left: auto;
            margin-right: auto;
        }
        #logo {
            width: 64px;
            height: 64px;
        }
        #em_logo {
            position: absolute;
            width: 200px;
            height: 80px;
        }
        #point {
            color: #fff;
            font-size: 60px;
        }
        #js {
            color: #fff;
            font-size: 60px;
            font-weight: bold;
        }
        .banner {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .vlc_head {
            flex: 1 1 0px;
        }
    </style>
</head>
<body>
    <div class="emscripten_border">
    <div class="emscripten">
        <div class="banner">
            <img src="./assets/emscripten.svg" id ="em_logo">
            <div class="vlc_head">
                <img src="./assets/VLC_Icon.svg" id="logo">
                <span id="point">.</span>
                <span id="js">JS</span>
            </div>
        </div>
        <progress id="progress" value="0" max="100"></progress>
        <div class="spinner" id='spinner'></div>
        <div class="emscripten" id="status">Downloading...</div>
    </div>
    </div>

    <div id="stack">
        <canvas
          class="emscripten" id="canvas"
          oncontextmenu="event.preventDefault()" tabindex=-1
          width=1280 height=720
        ></canvas>
        <canvas
          class="emscripten hidden" id="overlay"
          oncontextmenu="event.preventDefault()" tabindex=-2
          width=1280 height=720
        ></canvas>
    </div>

    <script src="./lib/module-loader.js"></script>
    <script src="./experimental.js"></script>

    <script type="module">
      import { update_overlay, on_overlay_click } from "./lib/overlay.js";
      import { MediaPlayer } from "./lib/libvlc.js";

      const Module = await VlcModule(VlcModuleExt);

      Module.setStatus('Downloading...');
      window.onerror = function(event) {
        // TODO: do not warn on ok events like simulating an infinite loop or exitStatus
        Module.setStatus('Exception thrown, see JavaScript console');
        spinnerElement.style.display = 'none';
        Module.setStatus = function(text) {
          if (text) Module.printErr('[post-exception status] ' + text);
        };
      };

      const overlay = document.getElementById("overlay");
      const media_player = new MediaPlayer(Module, "./samples/BigBuckBunny.mp4");

      window.media_player = media_player;
      window.on_overlay_click = on_overlay_click;
      window.update_overlay = update_overlay;

      update_overlay(overlay);

      addEventListener('worker_message', function(msg) {
        if (msg.detail === "on_position_changed") {
          update_overlay(overlay);
        }
      });
    </script>


</body>
</html>
